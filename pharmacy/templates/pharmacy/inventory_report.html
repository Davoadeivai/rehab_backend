{% extends 'base.html' %}
{% block content %}
<h2>گزارش موجودی و هشدارهای داروخانه</h2>
<a href="{% url 'pharmacy:inventory_report_excel' %}" class="btn btn-success mb-3">دانلود اکسل</a>
<a href="{% url 'pharmacy:inventory_report_pdf' %}" class="btn btn-danger mb-3">دانلود PDF</a>

<h3>موجودی فعلی داروها</h3>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>نام دارو</th>
            <th>موجودی</th>
            <th>مجموع خرید</th>
            <th>مجموع فروش</th>
        </tr>
    </thead>
    <tbody>
        {% for inv in inventories %}
        <tr>
            <td>{{ inv.drug.name }}</td>
            <td>{{ inv.quantity }}</td>
            <td>{{ purchases|get_item:inv.drug.name|default:'0' }}</td>
            <td>{{ sales|get_item:inv.drug.name|default:'0' }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="4">دارویی ثبت نشده است.</td></tr>
        {% endfor %}
    </tbody>
</table>

<h3>داروهای کم‌موجودی (کمتر از 10 عدد)</h3>
<ul>
    {% for inv in low_stock %}
    <li>{{ inv.drug.name }} ({{ inv.quantity }})</li>
    {% empty %}
    <li>موردی وجود ندارد.</li>
    {% endfor %}
</ul>

<h3>داروهای تاریخ مصرف گذشته</h3>
<ul>
    {% for drug in expired %}
    <li>{{ drug.name }} (تاریخ انقضا: {{ drug.expiration_date|date:'Y-m-d' }})</li>
    {% empty %}
    <li>موردی وجود ندارد.</li>
    {% endfor %}
</ul>
{% endblock %}

{% comment %}
نیاز به فیلتر get_item برای دیکشنری در قالب:
{{ dict|get_item:key }}
{% endcomment %} 