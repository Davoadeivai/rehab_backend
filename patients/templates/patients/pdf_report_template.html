<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <title>گزارش جامع بیماران</title>
    <style>
        @font-face {
            font-family: 'Vazir';
            src: url('static/fonts/Vazir.ttf') format('truetype');
        }
        body {
            font-family: 'Vazir', sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #1F4E78;
            padding-bottom: 10px;
        }
        .summary {
            background-color: #f5f5f5;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .patient-card {
            border: 1px solid #ddd;
            margin-bottom: 30px;
            padding: 15px;
            border-radius: 5px;
        }
        .patient-header {
            background-color: #1F4E78;
            color: white;
            padding: 10px;
            margin: -15px -15px 15px -15px;
            border-radius: 5px 5px 0 0;
        }
        .section {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .section-title {
            color: #1F4E78;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }
        th {
            background-color: #f5f5f5;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
            font-size: 0.9em;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>گزارش جامع بیماران</h1>
        <p>تاریخ گزارش: {{ current_date }}</p>
    </div>

    <div class="summary">
        <h2>خلاصه آماری</h2>
        <p>تعداد کل بیماران: {{ total_patients }}</p>
        <p>بیماران فعال: {{ active_patients }}</p>
        <p>بیماران با درمان تکمیل شده: {{ completed_patients }}</p>
    </div>

    {% for data in patients_data %}
    <div class="patient-card">
        <div class="patient-header">
            <h2>{{ data.patient.first_name }} {{ data.patient.last_name }}</h2>
            <p>شماره پرونده: {{ data.patient.file_number }}</p>
        </div>

        <div class="section">
            <h3 class="section-title">اطلاعات شخصی</h3>
            <table>
                <tr>
                    <th>کد ملی</th>
                    <td>{{ data.patient.national_code }}</td>
                    <th>تاریخ تولد</th>
                    <td>{{ data.formatted_dates.date_birth }}</td>
                </tr>
                <tr>
                    <th>جنسیت</th>
                    <td>{{ data.patient.get_gender_display }}</td>
                    <th>وضعیت تأهل</th>
                    <td>{{ data.patient.marital_status }}</td>
                </tr>
                <tr>
                    <th>شماره تماس</th>
                    <td>{{ data.patient.phone_number }}</td>
                    <th>تحصیلات</th>
                    <td>{{ data.patient.education }}</td>
                </tr>
                <tr>
                    <th>آدرس</th>
                    <td colspan="3">{{ data.patient.address }}</td>
                </tr>
            </table>
        </div>

        <div class="section">
            <h3 class="section-title">اطلاعات درمان</h3>
            <table>
                <tr>
                    <th>نوع ماده مصرفی</th>
                    <td>{{ data.patient.drug_type }}</td>
                    <th>نوع درمان</th>
                    <td>{{ data.patient.treatment_type }}</td>
                </tr>
                <tr>
                    <th>تاریخ پذیرش</th>
                    <td>{{ data.formatted_dates.admission_date }}</td>
                    <th>تاریخ خروج از درمان</th>
                    <td>{{ data.formatted_dates.treatment_withdrawal_date }}</td>
                </tr>
                <tr>
                    <th>مدت درمان</th>
                    <td>{{ data.treatment_duration }} روز</td>
                    <th>وضعیت فعلی</th>
                    <td>{{ data.treatment_status }}</td>
                </tr>
            </table>
        </div>

        {% if data.prescriptions %}
        <div class="section">
            <h3 class="section-title">نسخه‌های دارویی</h3>
            <table>
                <thead>
                    <tr>
                        <th>نوع دارو</th>
                        <th>دوز روزانه</th>
                        <th>تاریخ شروع</th>
                        <th>تاریخ پایان</th>
                        <th>مقدار کل</th>
                    </tr>
                </thead>
                <tbody>
                    {% for prescription in data.prescriptions %}
                    <tr>
                        <td>{{ prescription.medication_type.name }}</td>
                        <td>{{ prescription.daily_dose }}</td>
                        <td>{{ prescription.start_date|date:"Y/m/d" }}</td>
                        <td>{{ prescription.end_date|date:"Y/m/d" }}</td>
                        <td>{{ prescription.total_prescribed }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        {% if data.distributions %}
        <div class="section">
            <h3 class="section-title">توزیع دارو</h3>
            <table>
                <thead>
                    <tr>
                        <th>تاریخ توزیع</th>
                        <th>نوع دارو</th>
                        <th>مقدار</th>
                        <th>باقی‌مانده</th>
                        <th>یادداشت</th>
                    </tr>
                </thead>
                <tbody>
                    {% for distribution in data.distributions %}
                    <tr>
                        <td>{{ distribution.distribution_date|date:"Y/m/d" }}</td>
                        <td>{{ distribution.prescription.medication_type.name }}</td>
                        <td>{{ distribution.amount }}</td>
                        <td>{{ distribution.remaining }}</td>
                        <td>{{ distribution.notes }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        {% if data.payments %}
        <div class="section">
            <h3 class="section-title">پرداخت‌ها</h3>
            <p>مجموع پرداخت‌ها: {{ data.total_payments }} ریال</p>
            <table>
                <thead>
                    <tr>
                        <th>تاریخ پرداخت</th>
                        <th>مبلغ (ریال)</th>
                        <th>نوع پرداخت</th>
                        <th>توضیحات</th>
                    </tr>
                </thead>
                <tbody>
                    {% for payment in data.payments %}
                    <tr>
                        <td>{{ payment.payment_date }}</td>
                        <td>{{ payment.amount }}</td>
                        <td>{{ payment.payment_type }}</td>
                        <td>{{ payment.description }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
    {% endfor %}

    <div class="footer">
        <p>گزارش تولید شده در تاریخ {{ current_date }}</p>
    </div>
</body>
</html> 