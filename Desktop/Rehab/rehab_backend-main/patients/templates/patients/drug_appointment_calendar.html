{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css">
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.5.95/css/materialdesignicons.min.css" rel="stylesheet">
<link rel="stylesheet" href="{% static 'css/drug_appointment_calendar.css' %}">
{% endblock %}{% extends 'base.html' %}
{% load static %}

{% block title %}تقویم نوبت دارویی{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.5.95/css/materialdesignicons.min.css" rel="stylesheet">
<link rel="stylesheet" href="{% static 'css/drug_appointment_calendar.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <h2 class="mb-4">تقویم نوبت دارویی</h2>
    <div id="calendar"></div>

    <!-- Modal for add/edit appointment -->
    <div class="modal fade" id="appointmentModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle">ثبت نوبت جدید</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="appointmentForm">
              {% csrf_token %}
              <input type="hidden" id="appointmentId" name="appointment_id">
              <div class="mb-3">
                <label for="patientSelect" class="form-label">بیمار</label>
                <select class="form-select" id="patientSelect" name="patient_id" required>
                  <option value="">انتخاب کنید...</option>
                  {% for patient in patients %}
                  <option value="{{ patient.id }}" data-fullname="{{ patient.first_name }} {{ patient.last_name }}" data-code="{{ patient.patient_code }}" data-phone="{{ patient.phone_number }}" data-address="{{ patient.address }}">{{ patient.first_name }} {{ patient.last_name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="mb-3">
                <label for="dateInput" class="form-label">تاریخ نوبت (شمسی)</label>
                <input type="text" class="form-control" id="dateInput" name="date" required placeholder="مثال: ۱۴۰۴/۰۳/۱۷">
              </div>
              <div class="mb-3">
                <label for="timeInput" class="form-label">ساعت نوبت</label>
                <input type="time" class="form-control" id="timeInput" name="time" required>
              </div>
              <div class="mb-3">
                <label for="statusSelect" class="form-label">وضعیت</label>
                <select class="form-select" id="statusSelect" name="status">
                  <option value="scheduled">رزرو شده</option>
                  <option value="completed">تکمیل شده</option>
                  <option value="cancelled">لغو شده</option>
                  <option value="no_show">عدم حضور</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="notesInput" class="form-label">یادداشت</label>
                <textarea class="form-control" id="notesInput" name="notes" rows="2"></textarea>
              </div>
              <div class="mb-3" id="patientInfo" style="display:none; background:#f8f9fa; border-radius:8px; padding:10px;"></div>
              <div class="d-flex justify-content-between">
                <button type="submit" class="btn btn-primary" id="saveBtn">ثبت</button>
                <button type="button" class="btn btn-danger d-none" id="deleteBtn">حذف</button>
              </div>
            </form>
          </div>
        </div>
      </div>
 olt</div>

    <!-- Toast for notifications -->
    <div class="toast align-items-center text-bg-success border-0" id="successToast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="successToastBody"></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
    <div class="toast align-items-center text-bg-danger border-0" id="errorToast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="errorToastBody"></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/min/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment-jalaali@0.9.6/dist/moment-jalaali.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/fa.js"></script>
<script src="{% static 'js/drug_appointment_calendar.js' %}"></script>
{% endblock %}